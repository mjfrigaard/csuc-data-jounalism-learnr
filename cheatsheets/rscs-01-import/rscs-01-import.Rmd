---
title: "*Data import with readr, readxl, and googlesheets4*"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
    df_print: default
    includes:
      in_header: resizer.html
runtime: shiny_prerendered
description: >
  Import data from .csv, .xlsx, and googlesheets.
---

```{r setup, include = FALSE}
library(learnr)
library(tidyverse)
library(googlesheets4)
library(skimr)
library(knitr)
library(readxl)
# pipe url: https://bit.ly/01-file-txt ----
# CSV url: https://bit.ly/01-file-csv ----
# CSV2 url: https://bit.ly/01-file2-csv ----
# TSV url: https://bit.ly/01-file-tsv ----
# f1.csv: https://bit.ly/01-f1-csv ----
# f2.csv: https://bit.ly/01-f2-csv ----
# f3.csv: https://bit.ly/01-f3-csv ----
knitr::opts_chunk$set(error = TRUE,
  upload.fun = imgur_upload, 
  exercise.cap = "import cheatseet")
```

> "The tidyverse provides several packages for importing data into R and this cheatsheet covers three of them."

## The cheatsheet 

Access the cheatsheet [here](https://github.com/rstudio/cheatsheets/blob/main/data-import.pdf).

```{r 01-import-p1.png, echo=FALSE, fig.align='left', out.height='80%', out.width='80%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/01-import-p1.png")
```

```{r 01-import-p2.png, echo=FALSE, fig.align='right', out.height='80%', out.width='80%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/01-import-p2.png")
```

This cheatsheet covers importing data of various formats into RStudio. We're going to show how this looks on your machine (with examples). 

Below we install and load the packages:

```{r packages, eval=FALSE}
install.packages(c("readr", "googlesheets4"))
library(readr)
library(googlesheets4)
```


## Read Tabular Data with `readr` 

Below is an example of the data files on macOS. We can see each file name and extension is associated with a different 'Kind' (or type).

```{r files-folder.png, echo=FALSE, fig.align='center', out.height='90%', out.width='90%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/files-folder.png")
```

You can download the data uses in this example [here](https://github.com/mjfrigaard/csuc-data-jounalism-learnr/tree/main/cheatsheets/rscs-01-import/data).

We'll assume each data file is located in a `data/` folder like the one printed below: 

```{r data-tree, eval=FALSE}
# data/
#   ├── f1.csv
#   ├── f2.csv
#   ├── f3.csv
#   ├── file.csv
#   ├── file.tsv
#   ├── file.txt
#   └── file2.csv
```


## Read delimited files (`readr`)

There are four primary functions for importing delimited files: `read_delim()`, `read_csv()`, `read_csv2()`, and `read_tsv()`. 

We can also import plain text files by clicking *Import Dataset* in the **Environment** pane (see below:)

```{r env-pane.png, echo=FALSE, fig.align='center', out.height='50%', out.width='50%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/env-pane.png")
```

As we can see from the dropdown options, `readr`'s functions are designed to work with 'Text' (or 'plain text') files. There are also import functions from base R, but we won't cover those here. 

### Delimited files 

> "Read files with any delimiter. If no delimiter is specified, it will automatically guess"

All `readr` functions will import data from a local file *or* web URL. Below we use a URL for the `file.txt` data, which has the following structure: 

```{r file-txt.png, echo=FALSE, fig.align='center', out.height='50%', out.width='50%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/file-txt.png")
```

These are sometimes called [pipe-delimited flat files](https://en.wikipedia.org/wiki/Delimiter-separated_values), and their extension is usually `.txt` or `.dat`.

Click 'Run Code' to see the imported file:

```{r read_delim-file-txt, exercise=TRUE}
# identical to:
# readr::read_delim(file = "data/file.txt")
readr::read_delim(file = "https://bit.ly/01-file-txt")
```

As we can see, if we do not specify a `delim =` argument, `read_delim()` will guess based on the contents of `data/file.txt`.

Provide the `delim = ` argument, (just remember to include it in quotes)

```{r read_delim-file-txt-delim, exercise=TRUE}
# identical to:
# readr::read_delim(file = "data/file.txt", delim = "|")
readr::read_delim(file = "https://bit.ly/01-file-txt", delim = )
```


### Comma-separated values files (period decimals)

> "Read a comma delimited file with period decimal marks"

The `read_csv()` function will import a comma-separated values (csv) file, like the one we have in `data/file.csv`:

```{r file-csv.png, echo=FALSE, fig.align='center', out.height='50%', out.width='50%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/file-csv.png")
```

We've added a few decimal point values for demonstration purposes. 

Copy the URL below and place it (in quotes) in the `file =` argument.

```markdown
https://bit.ly/01-file-csv
```

Click 'Run Code' to see the imported file:

```{r file-csv-read_csv, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv")
read_csv(file = )
```

### Semicolon-separated values files (comma decimals)

> "Read semicolon delimited files with comma decimal marks."

Some datasets (like those from Sweden or Germany), will use commas for decimals (i.e. `0.5` = `0,5`) and semicolons as a delimiter (instead of pipes, tabs, or commas).

We have an example in `data/file2.csv`:

```{r file2-csv.png, echo=FALSE, fig.align='center', out.height='50%', out.width='50%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/file2-csv.png")
```

To import these files, use the `read_csv2()` function. 


Copy the URL below and place it (in quotes) in the `file =` argument.

```markdown
https://bit.ly/01-file2-csv
```

Click 'Run Code' to see the imported file:

```{r read_csv2-file2-csv, exercise=TRUE}
# identical to:
# readr::read_csv2(file = "data/file2.csv")
read_csv2(file = )
```

As we can see, `readr` tells us what was used as a `decimal` (as well as the `grouping mark`) and the `delimiter`.

### Tab-separated values files

> "Read a tab delimited file."

Tab-separated files are similar to comma-separated value files, except instead of using commas to delimit each value, they use tabs. In a text editor, these files appear to have white space between the values:

```{r file-tsv-png, echo=FALSE, fig.align='center', out.height='50%', out.width='50%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/file-tsv.png")
```

You might be wondering how `readr` can differentiate the white space *between values on the same line* and the white space *between rows*. This is because the white space between values contains a tab, which is a [special character](https://en.wikipedia.org/wiki/Tab_key#Tab_characters) used to identify tabs (`\t`). This is different from the invisible character used to identify a new row (or [Newline](https://en.wikipedia.org/wiki/Newline)), which  is `\n`.

Copy the URL below and place it (in quotes) in the `file =` argument.

```markdown
https://bit.ly/01-file-tsv
```

Click 'Run Code' to see the imported file:

```{r read_tsv-file-tsv, exercise=TRUE}
# identical to:
# readr::read_tsv(file = "data/file.tsv")
read_tsv(file = )
```


This comes in handy, because it means we can manually type the contents of a text file *directly* into any `read_*()` functions. Try it below: 

```markdown
# copy the lines below:
A\tB\tC\n1.5\t2\t3\n4.5\t5\tNA
```

```{r copy-readr, exercise=TRUE}
# paste the data between the quotes in read_delim()
readr::read_delim(file = "paste here")
```

### Delimited files (notes)

A few things to note when importing 'Text' files with `readr`: 

1. All data imported with `readr` functions are imported as a `tibble`.

2. `readr` gives us a lot of information whenever it imports a file (see below):

```{r read-delim-specs.png, echo=FALSE, fig.align='center', out.height='100%', out.width='100%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/read-delim-specs.png")
```

Depending on which function you use, this will include the delimiter, decimal, column names, dimensions and column specifications (which we will cover in the next sections).

## Useful Read Arguments

In this section we'll cover some additional arguments to give you more control over your imported datasets. 

### Column names (Headers)

> "No header."

If your dataset doesn't have column names, you can omit these with `col_names = FALSE`. 

Remove the column names and click 'Run Code' to see the imported file:

```{r col_names, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv", 
#                 col_names = FALSE)
readr::read_csv(file = "https://bit.ly/01-file-csv", 
                col_names = )
```

> "Provide header."

The default behavior is to name these columns `X1`, `X2`, `X3`, etc. However, you can also specify the column names as a string vector (i.e., `c("x", "y", "z")`)

Change the column names from `A`, `B`, `C` to `x`, `y`, `z` and click 'Run Code' to see the imported file:

```{r supply-col_names, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv", 
#                   col_names = c("x", "y", "z"))
readr::read_csv(file = "https://bit.ly/01-file-csv", 
                col_names = )
```

### Skip lines 

If there are lines we'd like to omit from our data file, we can use the `skip` argument and give a number of the lines we'd like to exclude.  

Skip the first line and click 'Run Code' to see the imported file:

```{r skip-lines, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv", skip = 1)
readr::read_csv(file = "https://bit.ly/01-file-csv", 
                skip = )
```

### Import multiple files 

> "Read multiple files into a single table."

We can also import multiple .csv files using a single call to `read_csv()`. Simply combine the names of the files in the `file` argument (in this case, it's three URLs.). We also supply an `id` argument, which will allow us to identify the original data file. 

Provide a name for the `id` variable (in quotes) and click 'Run Code' to see the imported files. 

```{r id-multiple, exercise=TRUE}
# identical to:
# readr::read_csv(file = c("data/f1.csv", "data/f2.csv", "data/f3.csv"), 
#                 id = 'origin_file')
readr::read_csv(file = c("https://bit.ly/01-f1-csv", 
                         "https://bit.ly/01-f2-csv", 
                        "https://bit.ly/01-f3-csv"), 
                        id = )
```

### Control imported rows

> "Read a subset of lines."

If we have a large dataset and would like to control the number of imported rows, we can use the `n_max` argument to set the maximum number of lines to read: 

Set the maximum number of rows to `2` and click 'Run Code' to see the imported file.

```{r n_max, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv", n_max = 2)
readr::read_csv(file = "https://bit.ly/01-file-csv", 
                n_max = )
```

### Set missing values 

> "Read values as missing."

We can also specify the values we'd like to set as 'missing'. By default, R detects `NA` as missing, but we can set this to whatever we want with the `na` argument (note that this needs to be a string).

Set the missing values to `1` (as a string) and click 'Run Code' to see the imported file.

```{r na, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv", na = c("1"))
readr::read_csv(file = "https://bit.ly/01-file-csv", 
                na = )
```


### Control formatting

> "Specify decimal marks."

Data conventions vary from place to place (as we saw before with the `file2.csv` example above). The `locale` argument gives us the ability to change the time zone, encoding, decimal mark, day/month names and more. 

The syntax is a little tricky--you'll actually use the `local` argument with the `locale()` function, like so:

```{r locale-decimal_mark, exercise=TRUE}
# identical to:
# read_delim(file = "data/file2.csv", 
#            locale = locale(decimal_mark = ","))
read_delim(file = "https://bit.ly/01-file2-csv", 
            locale = locale(decimal_mark = ","))
```

As we can see, the commas have been treated as decimals. 


## Column Specification with `readr`

As we've seen, `readr` display a lot of useful information on imported files. However, there is even more information in contained in the column specifications, or `spec`. We can also tell `reader` how to format the columns we're importing. 

### Extract column specification

> "Extract the full column specification for the given imported data frame."

We can extract the column specifications using the `spec()` argument on the imported data file. 

```{r spec-read_delim, eval=FALSE, echo=TRUE}
file <- readr::read_delim(file = "age\tsex\tearn\n25\tM\t85.5\n32\tF\t92.75")
file
```

```{r file, echo=FALSE, eval=TRUE}
file <- readr::read_delim(file = "age\tsex\tearn\n25\tM\t85.5\n32\tF\t92.75", show_col_types = FALSE)
rmarkdown::paged_table(file)
```


```{r setup-file, include=FALSE}
file <- readr::read_delim(file = "age\tsex\tearn\n25\tM\t85.5\n32\tF\t92.75", show_col_types = FALSE)
```


```{r ex-file, exercise.setup = "setup-file", exercise=TRUE}
# pass the 'file' to spec()
spec(x = )
```


### Hide column specification

> "Hide col spec message."

If we don't want to see the output from the column specification, we can hide this using the `show_col_types = ` argument: 

Hide the column specifications using `show_col_types` and click 'Run Code' to see the imported file.

```{r show_col_types, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv", show_col_types = FALSE)
readr::read_csv(file = "https://bit.ly/01-file-csv", 
                show_col_types = )
```


### Select columns to import

> "Use names, position, or selection helpers."

Import only the `A` and `C` columns (as `c(A, C)`) using the `col_select` argument and click 'Run Code' to see the imported file.

```{r col_select, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv", show_col_types = FALSE)
readr::read_csv(file = "https://bit.ly/01-file-csv", 
                col_select = )
```


### Column specifications (notes)

Most of these options are available from the data import GUI in the **Environment** pane. After clicking on *Import Dataset*, you'll select *From Text (readr)*. Click on *Browse* and navigate to a plain text file (the `file.csv` is show below as an example):

```{r import-readr-gui-path.png, echo=FALSE, fig.align='center', out.height='80%', out.width='80%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/import-readr-gui-path.png")
```

You'll see a preview of the data file in the **Data Preview** section, with each column name and format. I've indicated the options we've covered in the **Import Options** section: 

```{r import-readr-gui-options.png, echo=FALSE, fig.align='center', out.height='90%', out.width='90%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/import-readr-gui-options.png")
```

Next to the **Import Options** there is a **Code Preview** section that will create the code needed to import what you see in the **Data Preview** section. 

```{r import-readr-gui-code.png, echo=FALSE, fig.align='center', out.height='90%', out.width='90%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/import-readr-gui-code.png")
```

Changes to the **Import Options** will cause changes in the **Code Preview**. Below I change the *Skip*, *First Row as Names*, and *Open Data Viewer* options: 

```{r import-readr-gui-options-alt.png, echo=FALSE, fig.align='center', out.height='90%', out.width='90%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/import-readr-gui-options-alt.png")
```

And we can see the corresponding changes to the **Code Preview** section:

```{r import-readr-gui-code-alt.png, echo=FALSE, fig.align='center', out.height='90%', out.width='90%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/import-readr-gui-code-alt.png")
```

Using the GUI is a helpful tool for learning how the R code works for importing code!


## Save Data with `readr`

To export data with `readr`, we can use any of the corresponding `write_*()` functions. Each of these take an object in the current environment (`x`) and the desired `file` path (including the file extension):

> "Write files with any delimiter."


```{r write_delim-file_txt, eval=FALSE, echo=TRUE}
# read from data/
file_txt <- readr::read_delim(file = "data/file.txt")
# export to from processed-data/
write_delim(file_txt, file = "processed-data/file_txt.txt", delim = "|")
```

 
> "Write a comma delimited file."

```{r file_csv-write_csv, eval=FALSE, echo=TRUE}
# read from data/
file_csv <- readr::read_csv(file = "data/file.csv")
# export to from processed-data/
write_csv(x = file_csv, file = "processed-data/file_csv.csv") 
```


> "Write a semicolon delimited file."

```{r file2_csv-write_csv2, eval=FALSE, echo=TRUE}
# read from data/
file2_csv <- readr::read_csv2(file = "data/file2.csv")
# export to from processed-data/
write_csv2(x = file2_csv, file  "processed-data/file2_csv.csv")
```


> "Write a tab delimited file."

```{r file_tsv-write_tsv, eval=FALSE, echo=TRUE}
# read from data/
file_tsv <- readr::read_tsv(file = "data/file.tsv")
# export to from processed-data/
write_tsv(x = file_tsv, file = "processed-data/file_tsv.tsv") 
```


## Import data with `readxl`

Microsoft Excel files are commonly used for data entry and storage. Despite being a proprietary format, we're able to import these files using the `readxl` package. 

The data in this section are available at this [link](https://github.com/mjfrigaard/csuc-data-jounalism-learnr/raw/main/cheatsheets/rscs-01-import/data/readxl/readxl-data.xlsx). This file has the following contents: 

```{r excel-file.png, echo=FALSE, fig.align='center', out.height='90%', out.width='90%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/www/excel-file.png")
```

We'll proceed as though they've been downloaded into a local `data/readxl/` folder:

```{r setwd, echo=FALSE, results='hide'}
getwd()
setwd("/Users/mjfrigaard/Dropbox/@projects/high-priority/@data-journalism/course-website/csuc-data-jounalism-learnr/cheatsheets/rscs-01-import")
```


### Read files 

`readxl` comes with three functions for reading Excel files: `read_excel()`, `read_xls()`, and `read_xlxs()`

### Print sheets 

> "Get a vector of sheet names."

The best place to start is with `excel_sheets()`, which tells us the names of the sheets in an Excel file. 

```{r excel_sheets, eval=TRUE, echo=TRUE}
excel_sheets(path = "data/readxl/readxl-data.xlsx")
```


We can see this file has three sheets: `"f1.csv"`, `"f2.csv"`, `"f3.csv"`

### Read sheets

> "Specify which sheet to read by position or name."

If we want to import a sheet from the `readxl-data.xlsx` file, we can use the `read_excel()` function and specify the sheet name or position with the `sheet` argument.

Position is numeric, with `1` being the first sheet. 

```{r read_excel-f1-position, eval=TRUE, echo=TRUE}
read_excel(path = "data/readxl/readxl-data.xlsx", 
    sheet = 1)
```

If we want to use the name of the sheet, we must supply this as a string (in quotes) 

```{r read_excel-f1-name, eval=TRUE, echo=TRUE}
read_excel(path = "data/readxl/readxl-data.xlsx", 
    sheet = "f1.csv")
```

Just like the output from `excel_sheets()` above!

### Read multiple sheets

If we want to import all the sheets in `readxl-data`, we can combine `excel_sheets()` with `read_excel()` with [`map_dfr()`](https://purrr.tidyverse.org/reference/map.html) from the [`purrr` package](https://purrr.tidyverse.org/index.html). 

> 1. Get a vector of sheet names from the file path.  
> 2. Set the vector names to be the sheet names.   
> 3. Use `purrr::map_dfr()` to read multiple files into one data frame.  

I'll go into slightly more detail about what the code below is doing:

1. We assign the local path to a character string, `path`  
2. We then pipe `path` to `excel_sheets()`, and we know what this output will be from the step above (`"f1.csv"`, `"f2.csv"`, `"f3.csv"`)  
3. The `purrr::set_names()` names each item in `path`, turning it into this: `f1.csv = "f1.csv"`, `f2.csv = "f2.csv"`, `f3.csv = "f3.csv"`  
4. We then passed this named vector to the `.x` argument in the `map_dfr()` function, and we pass `read_excel()` to the `.f` argument    
5. The `read_excel()` function has a `path` argument, and we will pass the original `path` vector (where the file is located)  

```{r imoport-multiple-excel, eval=TRUE, echo=TRUE}
path <- "data/readxl/readxl-data.xlsx"
path %>% 
    excel_sheets() %>% 
    purrr::set_names() %>% 
    purrr::map_dfr(.x = ., .f = read_excel, path = path)
```

The `map_dfr()` function stands for "map data frame, row-bind", which means all the data have been 'stacked' into a long data format.  This is identical to: 

```{r import-sheets, eval=TRUE, echo=TRUE}
# import sheets
f1 <- read_excel(path = "data/readxl/readxl-data.xlsx", 
    sheet = 1)
f2 <- read_excel(path = "data/readxl/readxl-data.xlsx", 
    sheet = 2)
f3 <- read_excel(path = "data/readxl/readxl-data.xlsx", 
    sheet = 3)
# bind together 
bind_rows(f1, f2, f3)
```

Obviously we'd want to use the `map_dfr()` function to avoid a lot of copying and pasting. You can read more about Excel workflows on the [`readxl` website](https://readxl.tidyverse.org/).

### Column specification 

> "Column specifications define what data type each column of a file will be imported as."

We can specify the column types with the `col_types` argument. Below we set the columns in the `f1.csv` sheet to `"text"`.

```{r col_types, eval=TRUE, echo=TRUE}
read_excel(path = "data/readxl/readxl-data.xlsx", 
    sheet = "f1.csv", col_types = "text")
```

The options for `col_types` are: 




```{r , echo=FALSE, eval=TRUE}
reactable::reactable(data = 
tibble::tribble(
    ~logical, ~numeric,   ~text,        ~date,   ~list,
        TRUE,        2, "hello", "1947-01-08", "hello",
       FALSE,     3.45, "world", "1956-10-21",     "1"
    ) %>% mutate(date = lubridate::as_date(date)))
```


### Write sheets 

## Import data with `googlesheets4`

### Read sheets 

### Metadata 

### Column specifications 

### Write sheets 

## Conclusion

We've covered atomic vectors in these exercises--next up we will review R's S3 atomic vectors.

<div data-iframe-height></div>