---
title: "*Data import with readr, readxl, and googlesheets4*"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
    df_print: default
    includes:
      in_header: resizer.html
runtime: shiny_prerendered
description: >
  Import data from .csv, .xlsx, and googlesheets.
---

```{r setup, include = FALSE}
library(learnr)
library(tidyverse)
library(googlesheets4)
library(skimr)
library(knitr)
# pipe url: https://bit.ly/01-file-txt ----
# CSV url: https://bit.ly/01-file-csv ----
# CSV2 url: https://bit.ly/01-file2-csv ----
# TSV url: https://bit.ly/01-file-tsv ----
# f1.csv: https://bit.ly/01-f1-csv ----
# f2.csv: https://bit.ly/01-f2-csv ----
# f3.csv: 
knitr::opts_chunk$set(error = TRUE,
  upload.fun = imgur_upload, 
  exercise.cap = "import cheatseet")
```

> "The tidyverse provides several packages for importing data into R and this cheatsheet covers three of them."

## The cheatsheet 

Access the cheatsheet [here](https://github.com/rstudio/cheatsheets/blob/main/data-import.pdf).

```{r 01-import-p1.png, echo=FALSE, fig.align='left', out.height='80%', out.width='80%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/img/01-import-p1.png")
```

```{r 01-import-p2.png, echo=FALSE, fig.align='right', out.height='80%', out.width='80%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/img/01-import-p2.png")
```

This cheatsheet covers importing data of various formats into RStudio. We're going to show how this looks on your machine (with examples). 

Below we install and load the packages:

```{r packages, eval=FALSE}
install.packages(c("readr", "googlesheets4"))
library(readr)
library(googlesheets4)
```


## Read Tabular Data with `readr` 

Below is an example of the data files on macOS. We can see each file name and extension is associated with a different 'Kind' (or type).

```{r files-folder.png, echo=FALSE, fig.align='center', out.height='90%', out.width='90%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/img/files-folder.png")
```

You can download the data uses in this example [here](https://github.com/mjfrigaard/csuc-data-jounalism-learnr/tree/main/cheatsheets/rscs-01-import/data).

We'll assume each data file is located in a `data/` folder like the one printed below: 

```{r data-tree, eval=FALSE}
# data/
#   ├── f1.csv
#   ├── f2.csv
#   ├── f3.csv
#   ├── file.csv
#   ├── file.tsv
#   ├── file.txt
#   └── file2.csv
```


## Read delimited files (`readr`)

There are four primary functions for importing delimited files: `read_delim()`, `read_csv()`, `read_csv2()`, and `read_tsv()`. 

We can also import plain text files by clicking *Import Dataset* in the **Environment** pane (see below:)

```{r env-pane.png, echo=FALSE, fig.align='center', out.height='50%', out.width='50%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/img/env-pane.png")
```

As we can see from the dropdown options, `readr`'s functions are designed to work with 'Text' (or 'plain text') files. There are also import functions from base R, but we won't cover those here. 

### Delimited files 

> "Read files with any delimiter. If no delimiter is specified, it will automatically guess"

All `readr` functions will import data from a local file *or* web URL. Below we use a URL for the `file.txt` data, which has the following structure: 

```{r file-txt.png, echo=FALSE, fig.align='center', out.height='50%', out.width='50%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/img/file-txt.png")
```

These are sometimes called [pipe-delimited flat files](https://en.wikipedia.org/wiki/Delimiter-separated_values), and their extension is usually `.txt` or `.dat`.

Click 'Run Code' to see the imported file:

```{r read_delim-file-txt, exercise=TRUE}
# identical to:
# readr::read_delim(file = "data/file.txt")
readr::read_delim(file = "https://bit.ly/01-file-txt")
```

As we can see, if we do not specify a `delim =` argument, `read_delim()` will guess based on the contents of `data/file.txt`.

If we do provide the `delim =` argument, just remember to include it in quotes (`"|"`):

```{r read_delim-file-txt-delim, exercise=TRUE}
# identical to:
# readr::read_delim(file = "data/file.txt", delim = "|")
readr::read_delim(file = "https://bit.ly/01-file-txt", delim = "|")
```


### Comma-separated values files (period decimals)

> "Read a comma delimited file with period decimal marks"

The `read_csv()` function will import a comma-separated values (csv) file, like the one we have in `data/file.csv`:

```{r file-csv.png, echo=FALSE, fig.align='center', out.height='50%', out.width='50%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/img/file-csv.png")
```

We've added a few decimal point values for demonstration purposes. Click 'Run Code' to see the imported file:

```{r file-csv-read_csv, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv")
read_csv("https://bit.ly/01-file-csv")
```

### Semicolon-separated values files (comma decimals)

> "Read semicolon delimited files with comma decimal marks."

Some datasets (like those from Sweden or Germany), will use commas for decimals (i.e. `0.5` = `0,5`) and semicolons as a delimiter (instead of pipes, tabs, or commas).

We have an example in `data/file2.csv`:

```{r file2-csv.png, echo=FALSE, fig.align='center', out.height='50%', out.width='50%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/img/file2-csv.png")
```

To import these files, use the `read_csv2()` function. Click 'Run Code' to see the imported file:

```{r read_csv2-file2-csv, exercise=TRUE}
# identical to:
# readr::read_csv2(file = "data/file2.csv")
read_csv2("https://bit.ly/01-file2-csv")
```

As we can see, `readr` tells us what was used as a `decimal` (as well as the `grouping mark`) and the `delimiter`.

### Tab-separated values files

> "Read a tab delimited file."

Tab-separated files are similar to comma-separated value files, except instead of using commas to delimit each value, they use tabs. In a text editor, these files appear to have white space between the values:

```{r file-tsv-png, echo=FALSE, fig.align='center', out.height='50%', out.width='50%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/img/file-tsv.png")
```

But the white space contains a tab (a special character identified as `\t`). Click 'Run Code' to see the imported file:

```{r read_tsv-file-tsv, exercise=TRUE}
# identical to:
# readr::read_tsv(file = "data/file.tsv")
read_tsv("https://bit.ly/01-file-tsv")
```

### Delimited files (notes)

A few things to note when importing 'Text' files with `readr`: 

1. All data imported with `readr` functions are imported as a `tibble`.

2. `readr` gives us a lot of information whenever it imports a file (see below):

```{r read-delim-specs.png, echo=FALSE, fig.align='center', out.height='100%', out.width='100%'}
knitr::include_graphics(path = "https://raw.githubusercontent.com/mjfrigaard/csuc-data-jounalism-learnr/main/cheatsheets/rscs-01-import/img/read-delim-specs.png")
```

Depending on which function you use, this will include the delimiter, decimal, column names, dimensions and column specifications (which we will cover in the next sections).

## Useful Read Arguments

In this section we'll cover some additional arguments to give you more control over your imported datasets. 

### Column names (Headers)

If your dataset doesn't have column names, you can omit these with `col_names = FALSE`

```{r col_names, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv", 
#                 col_names = FALSE)
readr::read_csv(file = "https://bit.ly/01-file-csv", 
                col_names = FALSE)
```

The default behavior is to name these columns `X1`, `X2`, `X3`, etc. However, you can also specify the column names as a string vector (i.e., `c("x", "y", "z")`)

```{r supply-col_names, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv", 
#                   col_names = c("x", "y", "z"))
readr::read_csv(file = "https://bit.ly/01-file-csv", 
                col_names = c("x", "y", "z"))
```



### Skip lines 

If we want to only read a subset of the rows in our dataset, we can use the `skip` argument and give a number of the lines we'd like to omit. 

```{r skip-lines, exercise=TRUE}
# identical to:
# readr::read_csv(file = "data/file.csv", skip = 1)
readr::read_csv(file = "https://bit.ly/01-file-csv", skip = 1)
```

### Import multiple files 

We can also import multiple .csv files using a single call to `read_csv()`. Simply combine the names of the files in the `file` argument (in this case, it's three URLs.)



```{r}

```






## Column Specification with `readr`

## Save Data with `readr`

## Import spreadsheets with `readxl`

## Import spreadsheets with `googlesheets4`

## Conclusion

We've covered atomic vectors in these exercises--next up we will review R's S3 atomic vectors.

<div data-iframe-height></div>